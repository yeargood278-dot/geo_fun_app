<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è€ƒæ ¸æŒ‘æˆ˜</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style>
        .header { color: white; padding: 30px 20px; border-radius: 0 0 20px 20px; text-align: center; }
        .q-item { background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; border-left: 5px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .ans-show { display: none; background: #f8f9fa; padding: 10px; margin-top: 10px; border-radius: 5px; }
        .form-check-input { transform: scale(1.3); margin-right: 10px; } /* å¢å¤§ç‚¹å‡»åŒºåŸŸ */
    </style>
</head>
<body class="bg-light">
    <div class="header" id="quiz-header"><h2>ğŸ“ è€ƒæ ¸åŠ è½½ä¸­...</h2></div>
    <div class="container my-4" style="max-width: 800px;">
        <div id="quiz-container"></div>
        <div class="d-grid mb-5">
            <button class="btn btn-lg shadow text-white" id="submit-btn" onclick="check()">æäº¤ç­”å·</button>
        </div>
        <div id="partB" style="display: none;">
            <h4 class="text-danger mb-3">Part B: é€»è¾‘æ¨ç†</h4>
            <div id="logic-container"></div>
            <div class="text-center mt-5 pb-5">
                <a href="index.html" class="btn btn-secondary rounded-pill px-4 mx-2">ğŸ  é¦–é¡µ</a>
                <button id="map-btn" class="btn btn-primary rounded-pill px-4 mx-2">ğŸ—ºï¸ åœ°å›¾</button>
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script>
        const id = getQueryParam('id') || 'xb2c1s1';
        const content = courses[id];
        
        // ç¡®å®šä¸»é¢˜è‰²
        let bid = 'b1'; let color = '#3498db';
        if (id.startsWith('b2')) { bid = 'b2'; color = '#d35400'; }
        if (id.startsWith('xb1')) { bid = 'xb1'; color = '#27ae60'; }
        if (id.startsWith('xb2')) { bid = 'xb2'; color = '#9b59b6'; }
        if (id.startsWith('xb3')) { bid = 'xb3'; color = '#e74c3c'; }

        // æ¸²æŸ“ç•Œé¢
        document.getElementById('quiz-header').style.backgroundColor = color;
        document.getElementById('quiz-header').innerHTML = `<h2>ğŸ“ è€ƒæ ¸ï¼š${content.title}</h2>`;
        document.getElementById('submit-btn').style.backgroundColor = color;
        document.getElementById('map-btn').style.backgroundColor = color;
        document.getElementById('map-btn').onclick = () => location.href = `chapter_map.html?bid=${bid}`;

        // æ¸²æŸ“é¢˜ç›® Part A
        const qaContainer = document.getElementById('quiz-container');
        content.quiz.part_a.forEach((q, i) => {
            const typeBadge = q.type === 'single' ? 'å•é€‰' : 'å¤šé€‰';
            const inputType = q.type === 'single' ? 'radio' : 'checkbox';
            let optsHtml = '';
            q.opt.forEach(opt => {
                optsHtml += `
                <label class="list-group-item border-0 d-flex align-items-center">
                    <input class="form-check-input me-2" type="${inputType}" name="q_${i}" value="${opt.charAt(0)}">
                    ${opt}
                </label>`;
            });
            
            const html = `
            <div class="q-item" style="border-left-color:${color}" data-ans="${q.ans}">
                <h5 class="fw-bold"><span class="badge bg-secondary me-2">${typeBadge}</span>${i+1}. ${q.q}</h5>
                <div class="list-group mt-3">${optsHtml}</div>
                <div class="ans-show" style="color:${color}; border:1px solid ${color}"><strong>âœ… æ­£ç¡®ç­”æ¡ˆï¼š${q.ans}</strong><br>${q.expl}</div>
            </div>`;
            qaContainer.innerHTML += html;
        });

        // æ¸²æŸ“ Part B
        const qbContainer = document.getElementById('logic-container');
        content.quiz.part_b.forEach(l => {
            qbContainer.innerHTML += `
            <div class="card p-4 mb-3 border-danger shadow-sm">
                <h5>${l.title}</h5>
                <p class="fw-bold mt-2">${l.q}</p>
                <button class="btn btn-sm btn-outline-danger" onclick="this.nextElementSibling.style.display='block'">æŸ¥çœ‹åˆ†æ</button>
                <div class="ans-show text-dark mt-3" style="display:none">${l.ans}</div>
            </div>`;
        });

        function check() {
            let score = 0;
            const items = document.querySelectorAll('.q-item');
            items.forEach(el => {
                const correct = el.getAttribute('data-ans');
                const checked = Array.from(el.querySelectorAll('input:checked')).map(i=>i.value).sort().join('');
                el.querySelector('.ans-show').style.display = 'block';
                if(checked === correct) { score++; el.style.borderLeftColor = 'green'; } 
                else { el.style.borderLeftColor = 'red'; }
                el.querySelectorAll('input').forEach(i => i.disabled=true);
            });
            alert('è€ƒæ ¸ç»“æŸï¼å¾—åˆ†ï¼š' + score + '/' + items.length);
            document.getElementById('partB').style.display = 'block';
            window.scrollTo(0, document.body.scrollHeight);
        }
    </script>
</body>
</html>